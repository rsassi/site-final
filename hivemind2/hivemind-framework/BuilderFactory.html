<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>HiveMind Framework -
      hivemind.BuilderFactory Service</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
                </head>
  <body class="composite"><div style="background: red"><h1>2009/04/15 - Apache HiveMind has been retired. </h1><h2>For more information, please explore the <a href="http://attic.apache.org/">Attic</a>. </h2></div>
    <div id="banner">
                  <a href="http://hivemind.apache.org/" id="bannerLeft">

                                            <img src="../images/hivemind_banner.png" alt="" />

            </a>
                        <a href="http://www.apache.org" id="bannerRight">

                                            <img src="../images/asf_logo_wide.gif" alt="" />

            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">







            <div class="xleft">
        Last Published: 21 Feb 2007
                      </div>
            <div class="xright">      <a href="../index.html">HiveMind 2 Project</a>
          |
          <a href="../hivemind-framework">Framework</a>
          |
          <a href="../hivemind-xml">XML</a>
          |
          <a href="../hivemind-annotations">Annotations</a>
          |
          <a href="../hivemind-lib">Library</a>
          |
          <a href="../hivemind-jmx">JMX</a>







  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">







                   <h5>Quick Links</h5>
        <ul>

    <li class="none">
              <a href="../index.html">Project Home</a>
        </li>

    <li class="none">
              <a href="http://hivemind.apache.org/download.html">Download</a>
        </li>

    <li class="none">
              <a href="http://cwiki.apache.org/HIVEMIND2/">Wiki</a>
        </li>
          </ul>
          <h5>HiveMind Framework</h5>
        <ul>

    <li class="none">
              <a href="index.html">Introduction</a>
        </li>

    <li class="none">
              <a href="ApplicationDefaults.html">ApplicationDefaults</a>
        </li>

    <li class="none">
              <strong>BuilderFactory</strong>
        </li>

    <li class="none">
              <a href="EagerLoad.html">EagerLoad</a>
        </li>

    <li class="none">
              <a href="FactoryDefaults.html">FactoryDefaults</a>
        </li>

    <li class="none">
              <a href="LoggingInterceptor.html">LoggingInterceptor</a>
        </li>

    <li class="none">
              <a href="ObjectProviders.html">ObjectProviders</a>
        </li>

    <li class="none">
              <a href="ServiceModels.html">ServiceModels</a>
        </li>

    <li class="none">
              <a href="ShutdownCoordinator.html">ShutdownCoordinator</a>
        </li>

    <li class="none">
              <a href="SymbolSources.html">SymbolSources</a>
        </li>

    <li class="none">
              <a href="ThreadLocale.html">ThreadLocale</a>
        </li>

    <li class="none">
              <a href="ThreadLocalStorage.html">ThreadLocalStorage</a>
        </li>

    <li class="none">
              <a href="Translators.html">Translators</a>
        </li>
          </ul>
          <h5>Project Documentation</h5>
        <ul>







        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>







        <li class="collapsed">
              <a href="project-reports.html">Project Reports</a>
              </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>







        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">




      <p>The <a href="hivedocs/service/hivemind.BuilderFactory.html">
      BuilderFactory</a> service is a service implementation factory ... a
      service that is used to construct other services.</p>

      <p>The builder factory takes a single parameter element (usually with nested elements):</p>

      <div class="source"><pre>
&lt;construct
    class=&quot;...&quot; autowire-services=&quot;...&quot; log-property=&quot;...&quot; messages-property=&quot;...&quot;
    service-id-property=&quot;...&quot; initialize-method=&quot;...&quot; error-log-property=&quot;...&quot;
    error-handler-property=&quot;...&quot; class-resolver-property=&quot;...&quot;&gt;

    &lt;log/&gt;
    &lt;messages/&gt;
    &lt;service-id/&gt;
    &lt;error-handler/&gt;
    &lt;error-log/&gt;
    &lt;class-resolver/&gt;
    &lt;string&gt;  ... &lt;/string&gt;
    &lt;boolean&gt; ... &lt;/boolean&gt;
    &lt;configuration&gt; ... &lt;/configuration&gt;
    &lt;int&gt; ... &lt;/int&gt;
    &lt;long&gt; ... &lt;/long&gt;
    &lt;resource&gt; ... &lt;/resource&gt;
    &lt;service&gt; ... &lt;/service&gt;
    &lt;object&gt; ... &lt;/object&gt;
    &lt;null/&gt;

    &lt;event-listener service-id=&quot;...&quot; event-type-name=&quot;...&quot;/&gt;
    &lt;set property=&quot;...&quot; value=&quot;...&quot;/&gt;
    &lt;set-configuration property=&quot;...&quot; configuration-id=&quot;...&quot;/&gt;
    &lt;set-resource property=&quot;...&quot; path=&quot;...&quot;/&gt;
    &lt;set-service property=&quot;...&quot; service-id=&quot;...&quot;/&gt;
    &lt;set-object property=&quot;...&quot; value=&quot;...&quot;/&gt;
&lt;/construct&gt; </pre></div>
    <p>The attributes of the <code>construct</code> element are used to specify
      the implementation class and set common service properties. Nested
      elements supply the constructor parameters and configure other specific
      properties of the implementation (the <code>set-...</code> elements).</p>

      <p><strong>Note:</strong><br></br>
     BuilderFactory is a complex tool, with support for both constructor dependency injection and
     property dependency injection. Many of the options are rarely used; the most general purpose
     and most frequently used are <a href="#set">set</a>, <a href="#set-object">set-object</a>
     and <a href="#event-listener">event-listener</a> (along with
     <a href="#Autowiring">autowiring</a>).
      </p>

    <a name="construct"></a><div class="section"><h2>construct</h2>

      <table class="bodyTable">
        <tr class="a">
          <th>Attribute</th>
          <th>Required ?</th>
          <th>Description</th>
        </tr>
        <tr class="b">
          <td>autowire-services</td>
          <td>no</td>
          <td>If true (the default), then the BuilderFactory will attempt to
            automatically wire services and some common properties to constructor parameters
            and to properties of the constructed implementation with setter methods (see notes below).
            </td>
        </tr>
        <tr class="a">
          <td>class</td>
          <td>yes</td>
          <td>The fully qualified name of the class to instantiate.</td>
        </tr>
        <tr class="b"><td>class-resolver-property</td>
          <td>no</td>
            <td>The property to receive the module's
          <a href="apidocs/org/apache/hivemind/ClassResolver.html">ClassResolver</a>.</td></tr>
        <tr class="a"><td>error-handler-property</td>
          <td>no</td>
          <td> The name of a property to recieve the module's
            <a href="apidocs/org/apache/hivemind/ErrorHandler.html">ErrorHandler</a> instance (which is used to report recoverable
            errors). </td>
          </tr>
        <tr class="b">
          <td>error-log-property</td>
          <td>no</td>
          <td>The name of a property which will be assigned an <a href="apidocs/org/apache/hivemind/ErrorLog.html">ErrorLog</a> instance for the service. An ErrorLog is
            simply a wrapper around a Log and an <a href="apidocs/org/apache/hivemind/ErrorHandler.html">ErrorHandler</a> as is the preferred approach.</td>
        </tr>
        <tr class="a">
          <td>initialize-method</td>
          <td>no</td>
          <td>The name of a method (public, no parameters) to invoke after the
            service is constructed, to allow it to perform any final
            initializion before being put into use.</td>
        </tr>
        <tr class="b">
          <td>log-property</td>
          <td>no</td>
          <td>The name of a property which will be assigned a <code>
            org.apache.commons.logging.Log</code> instance for the service. The
            Log is created from the complete service id (not the name of the
            class). If ommitted (and autowiring is disabled), no Log will be assigned.</td>
        </tr>
        <tr class="a">
          <td>messages-property</td>
          <td>no</td>
          <td>Allows the <a href="apidocs/org/apache/hivemind/Messages.html">Messages</a> for the module to be assigned to a
            property of the instance.</td>
        </tr>
        <tr class="b">
          <td>service-id-property</td>
          <td>no</td>
          <td>Allows the service id of the <em>constructed</em> service to be
            assigned to a property of the service implementation.</td>
        </tr>
      </table>
      <p>The remaining elements are enclosed by the &lt;construct&gt; element,
        and are used to supply constructor parameters and configure properties
        of the constructed service implementation.</p>
    </div>

    <a name="Autowiring"></a><div class="section"><h2>Autowiring</h2>


      <p>
        With <code>autowire-services</code> set to true the BuilderFactory can automatically both perform
        constructor based and setter based dependency injection.  It will not only attempt to inject
        services but also certain common properties.  By using standard names (and standard types),
        the need to specify attributes <code>log-property</code>, <code>error-handler-property</code>,
        etc. is avoided.  Simply declaring a constructor parameter with the correct type <em>or</em> a
        writable property with the correct name <em>and</em> type is sufficient:
      </p>

      <table class="bodyTable">
        <tr class="a">
          <th>Property name</th>
          <th>Property / parameter type</th>
        </tr>
        <tr class="b">
          <td>classResolver</td>
          <td><a href="apidocs/org/apache/hivemind/ClassResolver.html">ClassResolver</a></td>
        </tr>
        <tr class="a">
          <td>errorHandler</td>
          <td><a href="apidocs/org/apache/hivemind/ErrorHandler.html">ErrorHandler</a></td>
        </tr>
        <tr class="b">
          <td>errorLog</td>
          <td><a href="apidocs/org/apache/hivemind/ErrorLog.html">ErrorLog</a></td>
        </tr>
        <tr class="a">
          <td>log</td>
          <td>
            <code>org.apache.commons.logging.Log</code>
          </td>
        </tr>
        <tr class="b">
          <td>messages</td>
          <td><a href="apidocs/org/apache/hivemind/Messages.html">Messages</a></td>
          <td></td>
        </tr>
        <tr class="a">
          <td>serviceId</td>
          <td>String</td>
        </tr>
      </table>

      <p><strong>Note:</strong><br></br>
        The service id (last entry in above table) will <em>only</em> be automatically injected through a writable property
        (i.e. <code>setServiceId(String)</code>).  This because a constructor parameter of type String
        is far too common.
      </p>

      <p>
        As noted the BuilderFactory will also inject services into the constructed service implementation.
        Through every constructor parameter and writable property whose type is an interface (with the exception
        of the common parameters / properties listed above) and hasn't been set otherwise the BuilderFactory will
        attempt to inject a service.  This attempt may fail if there is <em>no</em> visible service or <em>more than
        one</em> visible service implementing the given interface.  (Visibility is checked with respect to the module
        declaring the constructed service's implementation.)
      </p>

      <p>
        The action taken if the service injection fails (due to one of the reasons given above) depends on the type
        of dependency injection.  For constructor based dependency injection the BuilderFactory will try using a
        different constructor (see selection details below).  If no &quot;working&quot; constructor is found an error
        is logged.  For setter based dependency injection the BuilderFactory will log an error immedeately upon failed injection.
      </p>

      <p>
        Constructor based dependency injection is enabled with the <code>autowire-services</code> attribute but can be
        overridden by declaring any constructor parameter elements (see next section).  The constructor being used for
        the constructor based dependency injection has to meet all of the following criteria:
      </p>

      <ul>
        <li>the constructor is declared as <code>public</code></li>
        <li>all parameter types are interfaces (including the common types listed above)</li>
        <li>no two parameters are of the same type</li>
      </ul>


        All constructors of the service implementation class meeting these criteria (the default constructor is
        considered as one of these) are ordered by length (given by the number of parameters) and the first of these for which
        every parameter type either has a matching common property or there is exactly one corresponding visible service
        available will be invoked.  If no such constructor can be found an error is logged.



        Autowiring may be  complicated by the fact that one module may define a service point that will tangentially affect the
        construction of a service in another module (simply by implementing the same service interface).  In this situation,
        service autowiring can be turned off, by setting the <code>autowire-services</code> attribute to false.



       Once all properties have been set (possibly by autowiring), an initializer method will be invoked.  If the
       <code>initialize-method</code> attribute is <em>not</em> specified, and the service implementation includes a
       public method <code>initializeService()</code> (no parameters, returns void), then <code>initializeService()</code>
       will be invoked as the initializer.


    </div>

    <a name="Constructor Parameter Elements"></a><div class="section"><h2>Constructor Parameter Elements</h2>

      <p>The following table summarizes the elements which can be used to
        specify constructor parameters for the class to instantiate. These
        elements can be mixed freely with the properties configuring elements.
        It is important to know that the number, type, and order of the
        constructor parameter elements determine the constructor that will be
        used to instantiate the implementation.</p>
      <table class="bodyTable">
        <tr class="b">
          <th>Element</th>
          <th>Matched Parameter Type</th>
          <th>Passed Parameter Value</th>
        </tr>
        <tr class="a">
          <td>error-handler</td>
          <td><a href="apidocs/org/apache/hivemind/ErrorHandler.html">ErrorHandler</a></td>
          <td>The module's ErrorHandler, user to report recoverable errors.</td>
        </tr>
        <tr class="b">
          <td>error-log</td>
          <td><a href="apidocs/org/apache/hivemind/ErrorLog.html">ErrorLog</a></td>
          <td>The service's ErrorLog, used to report recoverable errors (this is preferred
      over using a Log and an <a href="apidocs/org/apache/hivemind/ErrorHandler.html">ErrorHandler</a>).</td>
        </tr>
        <tr class="a">
          <td>log</td>
          <td>org.apache.commons.logging.Log</td>
          <td>The Log is created from the complete service id (not the name of
            the class) of the created service.</td>
        </tr>
        <tr class="b">
          <td>messages</td>
          <td><a href="apidocs/org/apache/hivemind/Messages.html">Messages</a></td>
          <td>The <a href="apidocs/org/apache/hivemind/Messages.html">Messages</a> object of the invoking module.</td>
        </tr>
        <tr class="a">
          <td>object</td>
          <td><em>variable</em></td>
          <td>As determined by the object translator, this is decidedly free-form. See <a href="site:hivemind.ObjectProviders">hivemind.ObjectProviders</a>.</td>
        </tr>
        <tr class="b">
          <td>null</td>
          <td><em>any reference type</em></td>
          <td>Always simply <code>null</code>.</td>
        </tr>
        <tr class="a">
          <td>service-id</td>
          <td>java.lang.String</td>
          <td>The service id of the <em>constructed</em> service.</td>
        </tr>
        <tr class="b">
          <td>string</td>
          <td>java.lang.String</td>
          <td>This element's content.</td>
        </tr>
        <tr class="a">
          <td>boolean</td>
          <td>boolean</td>
          <td>This element's content. Must be either &quot;true&quot; or &quot;false&quot;.</td>
        </tr>
        <tr class="b">
          <td>configuration</td>
          <td>java.util.List <em>or</em> java.util.Map</td>
          <td>The List / Map of the elements of the configuration specified by this
            element's content as a configuration id. The id can either by a
            simple id for a configuration within the same module as the
            constructed service, or a complete id.</td>
        </tr>
        <tr class="a">
          <td>int</td>
          <td>int</td>
          <td>This element's content parsed as an integer value.</td>
        </tr>
        <tr class="b">
          <td>long</td>
          <td>long</td>
          <td>This element's content parsed as a long value.</td>
        </tr>
        <tr class="a">
          <td>resource</td>
          <td><a href="apidocs/org/apache/hivemind/Resource.html">Resource</a></td>
          <td>This element's content parsed as a path to a <a href="apidocs/org/apache/hivemind/Resource.html">Resource</a>, which
            is relative to the contributing module's deployment descriptor. If
            available, a localized version of the Resource will be selected.</td>
        </tr>
        <tr class="b">
          <td>service</td>
          <td>interface corresponding to specified service</td>
          <td>The implementation of the service with the id given in this
            element's content. The id can either be a simple id for a service
            within the same module as the constructed service, or a complete id.</td>
        </tr>
      </table>
    </div>
    <a name="Service Property Configuring Elements"></a><div class="section"><h2>Service Property Configuring Elements</h2>

      <a name="event-listener"></a><div class="section"><h3>event-listener</h3>

        <table class="bodyTable">
          <tr class="a">
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          <tr class="b">
            <td>service-id</td>
            <td>The service which produces events. The service must provide, in
              its service interface, the necessary add and remove listener
              methods.</td>
          </tr>
          <tr class="a">
            <td>name</td>
            <td>The name of an event set to be registered. If not specified, all
              applicable event sets are used.</td>
          </tr>
        </table>
        <p>If the name attribute is not specified, then BuilderFactory will
          register for all applicable event sets. For each event set provided by
          the specified service, BuilderFactory will check to see if the service
          instance being constructed implements the corresponding listener
          interface ... if so, the constructed service instance is added as a
          listener. When the name attribute is specified, the constructed
          service instance is registered as a listener of just that single type.</p>
        <p>Event notifications go directly to the constructed service instance;
          they don't go through any proxies or interceptors for the service. The
          service <em>instance</em> must implement the listener interface, the
          constructed service's service interface <em>does not</em> have to
          extend the listener interface. In other words, event notifications are
          &quot;behind the scenes&quot;, not part of the public API of the service.</p>
        <p>It is perfectly acceptible to include multiple &lt;event-listener&gt;
          elements for a number of different event producing services.</p>
        <p>It is not enough for the event producer service to have an add
          listener method (i.e., <code>
          addPropertyChangeListener(PropertyChangeListener)</code>). To be
          recognized as an event set, there must also be a corresponding remove
          listener method (i.e., <code>
          removePropertyChangeListener(PropertyChangeListener)</code>), even
          though BuilderFactory does not make use of the remove method. This is
          an offshoot of how the JavaBeans API defines event sets.</p>
      </div>
      <a name="set"></a><div class="section"><h3>set</h3>

        <table class="bodyTable">
          <tr class="b">
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          <tr class="a">
            <td>property</td>
            <td>The name of the property to set.</td>
          </tr>
          <tr class="b">
            <td>value</td>
            <td>A value to assigned to the property. The value will be converted
              to an appropriate type for the property.</td>
          </tr>
        </table>
      </div>
      <a name="set-configuration"></a><div class="section"><h3>set-configuration</h3>

        <table class="bodyTable">
          <tr class="a">
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          <tr class="b">
            <td>property</td>
            <td>The name of the property to set.</td>
          </tr>
          <tr class="a">
            <td>configuration-id</td>
            <td>The id of a configuration, either a simple id for a
              configuration within the same module as the constructed service,
              or a complete id. The property will be assigned a <code>List</code>
              or <code>Map</code> of the elements of the configuration.</td>
          </tr>
        </table>
      </div>
      <a name="set-object"></a><div class="section"><h3>set-object</h3>

          <table class="bodyTable">
            <tr class="b"><th>Attribute</th> <th>Description</th></tr>
            <tr class="a">
              <td>property</td>
              <td>The name of the property to set.</td>
            </tr>
            <tr class="b">
              <td>value</td>
              <td>The <em>selector</em> used to find an object value.  The selector consists of a prefix (such as
                &quot;service&quot; or &quot;configuration&quot;), a colon, and a <em>locator</em> whose interpretation is defined by
                the prefix.  For example, <code>service:MyService</code>.  See <a href="site:hivemind.ObjectProviders">hivemind.ObjectProviders</a>.</td>
            </tr>
          </table>
      </div>
      <a name="set-resource"></a><div class="section"><h3>set-resource</h3>

        <table class="bodyTable">
          <tr class="a">
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          <tr class="b">
            <td>property</td>
            <td>The name of the property to set.</td>
          </tr>
          <tr class="a">
            <td>path</td>
            <td>The path to a <a href="apidocs/org/apache/hivemind/Resource.html">Resource</a>, relative to the contributing
              module's deployment descriptor. If available, a localized version
              of the Resource will be selected.</td>
          </tr>
        </table>
      </div>
      <a name="set-service"></a><div class="section"><h3>set-service</h3>

        <table class="bodyTable">
          <tr class="b">
            <th>Attribute</th>
            <th>Description</th>
          </tr>
          <tr class="a">
            <td>property</td>
            <td>The name of the property to set.</td>
          </tr>
          <tr class="b">
            <td>service-id</td>
            <td>The id of a service, either a simple id for a service within the
              same module as the constructed service, or a complete id. The
              property will be assigned the service.</td>
          </tr>
        </table>
      </div>
    </div>


      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;
          2003-2007

          Apache Software Foundation







  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
